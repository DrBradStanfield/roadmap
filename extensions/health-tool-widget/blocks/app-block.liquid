<!-- Health Roadmap Tool - React Version -->
{% unless customer %}
  {% assign login_url = routes.account_url %}
{% endunless %}

<!-- CSS first so skeleton is styled immediately -->
{{ 'health-tool.css' | asset_url | stylesheet_tag }}

{% unless customer %}
<script>
(function() {
  try {
    if (!localStorage.getItem('health_roadmap_authenticated')) return;
    if (sessionStorage.getItem('health_roadmap_auth_redirect')) return;
    sessionStorage.setItem('health_roadmap_auth_redirect', '1');
    window.location.href = '{{ routes.account_url | default: "/account" }}' +
      '?return_url=' + encodeURIComponent(window.location.pathname + window.location.search);
  } catch(e) {}
})();
</script>
{% endunless %}

<div id="health-tool-root"
  {% if customer %}
    data-logged-in="true"
    data-account-url="{{ routes.account_url }}"
  {% else %}
    data-logged-in="false"
  {% endif %}
  {% if login_url %}data-login-url="{{ login_url }}"{% endif %}
>
  <!-- Static skeleton: replaced when React mounts -->
  <div class="health-tool">
    <div class="health-tool-header">
      <h2>Health Roadmap</h2>
      <p>Enter your health information below to receive personalized
        suggestions to discuss with your healthcare provider.</p>
    </div>
    <div class="health-tool-content">
      <div class="health-tool-left">
        <div class="skeleton-block" style="height:160px"></div>
        <div class="skeleton-block" style="height:120px"></div>
        <div class="skeleton-block" style="height:120px"></div>
      </div>
      <div class="health-tool-right">
        <div class="skeleton-block" style="height:200px"></div>
      </div>
    </div>
  </div>
</div>

<!-- Load React app with defer so skeleton renders while JS downloads -->
<script src="{{ 'health-tool.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Health Roadmap Tool",
  "target": "section",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Health Roadmap"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description",
      "default": "Enter your health information to receive personalized suggestions."
    }
  ]
}
{% endschema %}
